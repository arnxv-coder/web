<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GoalForge — Full Goal Tracker (Single File)</title>

  <!-- Tailwind CDN for quick modern UI -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.04); }
    .tiny { font-size: .8rem; color: #9ca3af; }
    .muted { color: #94a3b8; }
    .btn-flat { background: transparent; border: 1px solid rgba(255,255,255,0.06); padding: 6px 8px; border-radius: 8px; }
    body { background: linear-gradient(180deg,#0f172a,#071029); }
  </style>
</head>
<body class="min-h-screen text-white antialiased">

  <header class="p-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="text-xl font-semibold">GoalForge</div>
      <div class="tiny">Offline goal tracker — single file</div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto p-4 grid grid-cols-1 md:grid-cols-2 gap-4">

    <!-- Add Goal Section -->
    <section>
      <div class="p-4 card rounded-lg">
        <h3 class="font-semibold text-lg">Add Goal</h3>
        <input id="goalTitle" placeholder="Goal title" class="w-full mt-2 p-2 rounded bg-slate-900 border border-slate-700" />
        <textarea id="goalNote" placeholder="Notes / motivation" class="w-full mt-2 p-2 rounded bg-slate-900 border border-slate-700"></textarea>
        <input id="goalTarget" type="number" placeholder="Target amount" class="w-full mt-2 p-2 rounded bg-slate-900 border border-slate-700" />
        <input id="goalDeadline" type="datetime-local" class="w-full mt-2 p-2 rounded bg-slate-900 border border-slate-700" />
        <input id="goalTags" placeholder="Tags (comma separated)" class="w-full mt-2 p-2 rounded bg-slate-900 border border-slate-700" />
        <div class="flex gap-2 mt-2">
          <button id="btnAddGoal" class="bg-cyan-500 px-3 py-2 rounded">Add Goal</button>
          <button id="btnClearAll" class="bg-rose-600 px-3 py-2 rounded">Clear All</button>
        </div>
      </div>
    </section>

    <!-- Goals List -->
    <section>
      <h3 class="text-lg font-semibold mb-2">Your Goals</h3>
      <div id="goalsContainer" class="space-y-3"></div>
    </section>

  </main>

  <script>
    // --- LocalStorage key ---
    const STORAGE_KEY = 'goalforge_data_v1';
    let data = { goals: [] };

    // --- Utilities ---
    const uid = () => 'g_' + Date.now() + '_' + Math.floor(Math.random()*9999);
    const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    const load = () => {
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw) data = JSON.parse(raw);
      renderGoals();
    }

    // --- Add Goal ---
    document.getElementById('btnAddGoal').addEventListener('click', ()=>{
      const title = document.getElementById('goalTitle').value.trim();
      if(!title) return alert('Add a title');
      const note = document.getElementById('goalNote').value.trim();
      const target = Number(document.getElementById('goalTarget').value)||0;
      const deadline = document.getElementById('goalDeadline').value || null;
      const tags = document.getElementById('goalTags').value.split(',').map(s=>s.trim()).filter(Boolean);
      const g = { id: uid(), title, note, target, saved:0, deadline, tags, milestones:[] };
      data.goals.unshift(g);
      save();
      renderGoals();
      // clear inputs
      document.getElementById('goalTitle').value = '';
      document.getElementById('goalNote').value = '';
      document.getElementById('goalTarget').value = '';
      document.getElementById('goalDeadline').value = '';
      document.getElementById('goalTags').value = '';
    });

    // --- Clear All Goals ---
    document.getElementById('btnClearAll').addEventListener('click', ()=>{
      if(confirm('Clear all goals?')) {
        data.goals = [];
        save();
        renderGoals();
      }
    });

    // --- Milestone ---
    function addMilestone(goalId){
      const title = prompt('Milestone title:');
      if(!title) return;
      const amount = Number(prompt('Amount (optional, number):','0'))||0;
      const goal = data.goals.find(g=>g.id===goalId);
      goal.milestones.push({ id: uid(), title, amount, done:false });
      save();
      renderGoals();
    }

    function toggleMilestone(goalId, milestoneId){
      const goal = data.goals.find(g=>g.id===goalId);
      const m = goal.milestones.find(m=>m.id===milestoneId);
      m.done = !m.done;
      if(m.done) goal.saved += m.amount;
      else goal.saved -= m.amount;
      save();
      renderGoals();
    }

    // --- Delete goal ---
    function deleteGoal(goalId){
      if(confirm('Delete this goal?')) {
        data.goals = data.goals.filter(g=>g.id!==goalId);
        save();
        renderGoals();
      }
    }

    // --- Render Goals ---
    function renderGoals(){
      const container = document.getElementById('goalsContainer');
      container.innerHTML = '';
      data.goals.forEach(g=>{
        const div = document.createElement('div');
        div.className = 'p-4 card rounded-lg flex flex-col gap-2';
        const pct = g.target? Math.min(100, Math.round(g.saved/g.target*100)) : g.milestones.length ? Math.round(g.milestones.filter(m=>m.done).length/g.milestones.length*100) : 0;
        div.innerHTML = `
          <div class="flex justify-between">
            <div>
              <div class="font-semibold">${g.title}</div>
              <div class="tiny">${g.note||''}</div>
              <div class="tiny mt-1">${g.tags.map(t=>`<span class="px-2 py-0.5 mr-1 rounded bg-white/5 text-xs">${t}</span>`).join('')}</div>
            </div>
            <div class="flex flex-col items-end">
              <div class="tiny">${g.target? `Saved: ${g.saved}/${g.target}` : `${g.milestones.filter(m=>m.done).length}/${g.milestones.length} done`}</div>
            </div>
          </div>
          <div class="w-full bg-slate-800 rounded h-3 overflow-hidden mt-1">
            <div class="h-3 bg-cyan-500" style="width:${pct}%"></div>
          </div>
          <div class="flex gap-2 mt-2">
            <button class="px-2 py-1 rounded btn-flat" onclick="addMilestone('${g.id}')">+ Milestone</button>
            <button class="px-2 py-1 rounded btn-flat" onclick="deleteGoal('${g.id}')">Delete</button>
          </div>
          <div class="mt-2 space-y-1">
            ${g.milestones.map(m=>`
              <div>
                <input type="checkbox" ${m.done?'checked':''} onchange="toggleMilestone('${g.id}','${m.id}')">
                ${m.title} (${m.amount})
              </div>
            `).join('')}
          </div>
        `;
        container.appendChild(div);
      });
    }

    // --- Escape HTML ---
    function escapeHtml(str) {
      if(!str) return '';
      return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }

    // --- Initial load ---
    load();
  </script>

</body>
</html>
